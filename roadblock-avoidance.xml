<?xml version="1.0"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
  <!ENTITY rfc2119 PUBLIC '' 'reference.RFC.2119.xml'>
  <!ENTITY rfc4034 PUBLIC '' 'reference.RFC.4034.xml'>
  <!ENTITY rfc4035 PUBLIC '' 'reference.RFC.4035.xml'>
  <!ENTITY rfc5155 PUBLIC '' 'reference.RFC.5155.xml'>
]>
<?rfc strict="no" ?>
<?rfc toc="yes" ?>
<?rfc tocdepth="3" ?>
<?rfc symrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<rfc category="bcp" ipr="trust200902" docName="draft-hardaker-dnsop-dnssec-roadblock-avoidance-FILLVERSION.txt">
  <front>
    <title abbrev="DNSSEC Roadblock Avoidance">
      DNSSEC Roadblock Avoidance
    </title>
    <author initials="W.H." surname="Hardaker" fullname="Wes Hardaker">
      <organization>Sparta</organization>
      <address>
        <postal>
          <street>P.O. Box 382</street>
          <city>Davis</city>
	  <region>CA</region>
          <code>95617</code>
          <country>US</country>
        </postal>
        <email>hardaker@tislabs.com</email>
      </address>
    </author>
    <date month="January" year="1970"/>
    <!--
    <area ...>
    <workgroup ...>
    <keyword ...>
    <keyword ...>
    -->
    <abstract>
      <!-- $Revision: 1.28 $ -->
      <t>
        This document describes problems with DNSSEC deployment due to
        non-compliant infrastructure.  It poses potential detection and
        midigation techniques.
      </t>
    </abstract>
  </front>
  <middle>
    <section title="Introduction">
      <t>This document describes problems with DNSSEC (<xref
      target="RFC4034" />, <xref target="RFC4035" />) deployment due to
        non-compliant infrastructure.  It poses potential detection and
        midigation techniques.
      </t>
      <t>
	The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
	"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
	document are to be interpreted as described in
	<xref target="RFC2119" />.
      </t>
    </section>
    <section title="Background">
      <t>Deployment of DNSSEC today is hampered by network
      architectures that make it difficult or sometimes impossible for
      validating stub resolvers to effectively obtain the DNSSEC data
      they need.  This occurs because neighboring recursive resolvers
      are not fully DNSSEC compliant, or because "middle-boxes" active
      block outbound traffic to the DNS port (53).</t>
      <t>This document talks about ways of detecting the state of the
      network a validating stub resolver might be attached to, and
      ways to hopefully circumvent the problems associated with the
      network defects it discovers.</t>
    </section>

    <section title="Goals">
      <t>The result of this work is intended to show how a validating
      stub resolver can interact with a nearby recursive resolver
      whenever possible.  This enables the validating stub resolver to
      make use of the caching functionality in the recursive resolver,
      which decreases network traffic and increases response
      times.</t>

      <t>A validating stub resolver has two choices: it can wait to
      determine that it has problems with a recursive resolver based
      on the results that it is getting from legitimate queries issued
      to it, or it can proactively test for problems (Section <xref
      target="tests" />) to build a work around list ahead of time
      (Section <xref target="solutions" />).  There are pros and cons
      to both these paths that are application specific, and this
      document does not attempt to provide guidance about whether
      proactive tests should or should not be used.  Either way,
      however, DNSSEC roadblock avoidance techniques should be used
      when needed and if possible.</t>
    </section>

    <section title="Detecting DNSSEC Non-Compilance" anchor="tests">
      <t>A validating stub resolver must fist determine what
      bottlenecks exist that may hamper its ability to perform DNSSEC
      lookups.  This section outlines tests that can be done to test
      certain features of the surrounding network.</t>
      <section title="Determining DNSSEC support in neighboring
	recursive resolvers">
	<t>Ideally, a validating stub resolver can make use of the
	caching present in neighboring recursive resolvers.  This
	section discusses the tests that such a recursive resolver
	must pass in order to be fully usable as a near-by DNS
	cache.</t>
	<t>Unless stated otherwise, all of the following tests should
	have the recursive flag set when sending out a query.  Unless
	stated otherwise, the request should be sent over UDP.</t>
	<section title="Supports UDP">
	  <t>Purpose: This tests basic UDP functionality to a resolver.  </t>
	  <t>Test: A DNS
	  request should be sent to the resolver under test for an A
	  record for a known existing domain, such as
	  www.dnssec-tools.org.</t>
	  <t>SUCCESS: A DNS response was received that contains an a A
	  record in the answer section.  (The data itself does not need
	  to be checked.)</t>
	  <t>Note: an implementation MAY chose to not perform the rest
	  of the tests if this test fails, as clearly the resolver
	  under test is severely broken.</t>
	</section>
	<section title="Supports TCP">
	  <t>Purpose: This tests basic TCP functionality to a resolver.  </t>
	  <t>Test: A DNS
	  request should be sent over TCP to the resolver under test for an A
	  record for a known existing domain, such as
	  www.dnssec-tools.org.</t>
	  <t>SUCCESS: A DNS response was received that contains an a A
	  record in the answer section.  (The data itself does not need
	  to be checked.)</t>
	</section>
	<section title="Supports the DO bit">
	  <t>Purpose: This tests weather has minimal support of the DO bit.
	  </t>
	  <t>Test: send a request to the resolver under test for an A record
	  for a known existing domain such as www.dnssec-tools.org.
	  Set the DO bit in the outgoing query.</t>
	  <t>SUCCESS: A DNS response was received that contains the DO
	  bit set.</t>
	  <t>Note: this only tests that the resolver sets the DO bit
	  in the response.  Later checks will determine if the DO bit
	  was actually made use of.  Some resolvers successfully pass
	  this test because they simply copy the unknown flags into
	  the response.  Don't worry, they'll fail the later tests.</t>
	</section>
	<section title="Supports the AD bit">
	  <t>Purpose: This weather the resolver is a validating
	  resolver.</t>
	  <t>Test: Send a request to the resolver under test for an A
	  record for a known existing domain in a DNSSEC signed zone
	  which is verifiable to a configured trust anchor, such as
	  www.dnssec-tools.org using the root's published DNSKEY or DS
	  record as a trust anchor.  Set the DO bit in the outgoing
	  query.</t>

	  <t>SUCCESS: A DNS response was received that contains the AD
	  bit set.</t>
	</section>
	<section title="Supports querying for RRSIGs">
	  <t>Purpose: This tests whether a resolver will properly return RRSIG
	  records when the DO bit is set.</t>
	  <t>Test: Send a request to the resolver
	  under test for an A record for a known existing domain in a
	  DNSSEC signed zone, such as www.dnssec-tools.org.  Set the
	  DO bit in the outgoing query.</t>

	  <t>SUCCESS: A DNS response was received that contains at
	  least one RRSIG record.</t>
	</section>
	<section title="Supports EDNS0">
	  <t>Purpose: This tests whether a resolver properly supports the EDNS0
	  extension option.</t>
	  <t>Test: Send a request to the resolver under test for an
	  A record for a known existing domain, such as
	  www.dnssec-tools.org.</t>

	  <t>SUCCESS: A DNS response was received that contains at
	  an EDNS0 option with version number 0.</t>
	  <t>WARNING???: if the EDNS0 size returned was less than
	  1480. XXX: this will probably go away, since there is no
	  reason a local resolver needs to support accepting large
	  packets from the querying client; they only need to do so
	  for *their* outgoing requests.</t>
	</section>
	<section title="Supports queries returning NSEC records">
	  <t>Purpose: This tests whether a resolver properly returns
	  NSEC records for a non-existing domain in a DNSSEC signed zone.</t>
	  <t>Test: Send a request to the resolver under test for an A
	  record which is known to not existing, such as
	  bogusdnstest.dnssec-tools.org.</t>
	  <t>SUCCESS: A DNS response was received that contains an
	  NSEC record.</t>
	</section>
	<section title="Supports queries returning NSEC3 records">
	  <t>Purpose: This tests whether a resolver properly returns
	  NSEC3 records (<xref target="RFC5155" />) for a non-existing
	  domain in a DNSSEC signed zone.</t>
	  <t>Test: Send a request to the resolver under test for an A
	  record which is known to not existing, such as
	  foobardedabadoo.org.</t>
	  <t>SUCCESS: A DNS response was received that contains an
	  NSEC3 record.</t>
	</section>
	<section title="Supports querying for DNSKEY records">
	  <t>Purpose: This tests whether a resolver can query for and
	  receive a DNSKEY record from a signed zone.</t>
	  <t>Test: Send a request to the resolver under test for an DNSKEY
	  record which is known to exist in a signed zone, such as
	  dnssec-tools.org/DNSKEY.</t>
	  <t>SUCCESS: A DNS response was received that contains a
	   DNSKEY record in the answer section.</t>
	</section>
	<section title="Supports querying for DS records">
	  <t>Purpose: This tests whether a resolver can query for and
	  receive a DS record from a signed zone.</t>
	  <t>Test: Send a request to the resolver under test for an DS
	  record which is known to exist in a signed zone, such as
	  dnssec-tools.org/DS.</t>
	  <t>SUCCESS: A DNS response was received that contains a
	   DS record in the answer section.</t>
	</section>
	<section title="Supports queries returning DNAME records">
	  <t>Purpose: This tests whether a resolver can query for an A
	  record in a zone with a known DNAME referral for the record's
	  parent.</t>
	  <t>Test: Send a request to the resolver under test for an A
	  record which is known to exist in a signed zone within a
	  DNAME referral child zone, such as
	  good-a.dname-good-ns.test.dnssec-tools.net.</t>
	  <t>SUCCESS: A DNS response was received that contains a
	   DNAME in the answer section.  An RRSIG must also be
	  received in the answer section that covers the DNAME record.</t>
	</section>
      </section>
      <section title="Direct Network Queries">
	<t>If need be, a validating stub resolver may need to make
	direct queries to authoritative servers in order to collect
	the data they require.  To do that, a number of key network
	features must be functional.</t>
	<section title="Outbound UDP Support Over Port 53">
	  <t>Purpose: This tests basic UDP functionality to outside
	  the local network.</t>
	  <t>Test: A DNS
	  request should be sent to a known distant authoritative
	  server for a record known to be within that server's
	  authoritative data.  Example: send a query to the address of
	  ns1.dnssec-tools.org for the www.dnssec-tools.org/A record.</t>
	  <t>SUCCESS: A DNS response was received that contains an a A
	  record in the answer section.</t>
	  <t>Note: an implementation can used the local resolvers for
	  determining the address of the name server that is
	  authoritative for the given zone.  The recursive bit MAY be
	  set for this request, but does not need to be.</t>
	</section>
	<section title="Inbound UDP Support With Fragmentation">
	</section>
	<section title="Outbound TCP Support Over Port 53">
	  <t>Purpose: This tests basic TCP functionality to outside
	  the local network.</t>
	  <t>Test: A DNS
	  request should be sent over TCP to a known distant authoritative
	  server for a record known to be within that server's
	  authoritative data.  Example: send a query to the address of
	  ns1.dnssec-tools.org for the www.dnssec-tools.org/A record.</t>
	  <t>SUCCESS: A DNS response was received that contains an a A
	  record in the answer section.</t>
	  <t>Note: an implementation can used the local resolvers for
	  determining the address of the name server that is
	  authoritative for the given zone.  The recursive bit MAY be
	  set for this request, but does not need to be.</t>
	</section>
      </section>
    </section>

    <section title="Aggregating The Results">
      <t>Some conclusions can be drawn from the results of the above
      tests in an "aggregated" form.  This section defines some labels
      to assign to a resolver under test given the results of the
      tests run against them.</t>
    </section>

    <section title="Roadblock Avoidance" anchor="solutions">
      <t>Once we have determined what level of support is available in
      the neighboring network, we can determine what must be done in
      order to effectively act as a validating resolver.  This section
      discusses some of the options available given the results from
      the previous sections.</t>
    </section>

    <section title="IANA Considerations">
      <t>No IANA actions are require to support this document</t>
    </section>

    <section title="Security Considerations">
      <t>This document discusses problems that may occur while
      deploying the secure DNSSEC protocol and what mitigations can be
      used to help detect and midigate these problems.  Following
      these suggestions should result in a more secure DNSSEC
      operational environment than if DNSSEC was simply disabled when
      it fails to perform as expected.</t>
    </section>
    
    <section title="Acknowledgments">
      <t>Many of the tests in this document were designed during many
      discussions with Ólafur Guðmundsson, without whom these tests
      would be significantly less complete.</t>

      <t>Multiple lessons learned from multiple implementations led to
      the development of this document, including (in alphabetical
      order) DNSSEC-Tools, dnssec-trigger, ...
      </t>
      
      <t>The following people contributed to portions of this document
      in some fashion: ....
      </t>
    </section>
    
  </middle>
  <back>
    <references title="Normative References">
      &rfc2119;
      &rfc4034;
      &rfc4035;
      &rfc5155;
    </references>
  </back>
</rfc>
